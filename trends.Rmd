---
title: "Trends"
---

## Visualize/analyze trends of winners/matches over multiple years
```{r setup, echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
library(ggplot2)
library(lubridate)
library(dplyr)
library(plotly)
library(leaflet)

tennis_data = read.csv("data/cleaned_df_webscraping_data_added.csv")

tennis_data$tourney_date = as.Date(tennis_data$tourney_date)

tennis_data$winner_age = as.numeric(tennis_data$winner_age)
tennis_data$loser_age = as.numeric(tennis_data$loser_age)
tennis_data$minutes = as.numeric(tennis_data$minutes)
```

### Trends of Winners Over Time
```{r winners, echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)

tennis_data$tourney_date = as.Date(tennis_data$tourney_date)

grand_slams = c("Australian Open", "Roland Garros", "Wimbledon", "US Open")

matches_grand_slam = tennis_data %>%
  filter(tourney_name %in% grand_slams) %>%
  drop_na(winner_name)

yearly_wins = matches_grand_slam %>%
  group_by(year = format(tourney_date, "%Y"), winner_name) %>%
  summarise(wins = n(), .groups = "drop")

top_winners_per_year = yearly_wins %>%
  group_by(year) %>%
  slice_max(order_by = wins, n = 1) %>%
  ungroup()

ggplot(top_winners_per_year, aes(x = as.integer(year), y = wins, color = winner_name)) +
  geom_line() +
  geom_point(size = 3) +
  theme_minimal() +
  labs(title = "Trends of ATP Winners Over Time in Grand Slams",
       x = "Year", y = "Number of Wins") +
  theme(legend.position = "right") +
  scale_x_continuous(breaks = unique(as.integer(top_winners_per_year$year)))
```

### Age Trends of Winners and Losers
```{r age, echo = FALSE, message = FALSE, warning = FALSE}
player_ages <- tennis_data %>%
  mutate(year = format(as.Date(tourney_date), "%Y")) %>%
  select(year, winner_age, loser_age) %>%
  pivot_longer(cols = c(winner_age, loser_age), names_to = "role", values_to = "age")

ggplot(player_ages, aes(x = year, y = age, fill = role)) +
  geom_boxplot() +
  labs(title = "Age Distribution of Winners and Losers by Year",
       x = "Year", y = "Age") +
  theme_minimal()
```

### Match Duration by Year
```{r matchduration, echo = FALSE, message = FALSE, warning = FALSE}
match_length <- matches_grand_slam %>%
  group_by(year = as.numeric(format(tourney_date, "%Y"))) %>%
  summarise(avg_minutes = mean(minutes, na.rm = TRUE)) %>%
  arrange(year)

p <- ggplot(match_length, aes(x = year, y = avg_minutes)) +
  geom_line(color = "blue") +
  theme_minimal() +
  scale_x_continuous(breaks = match_length$year) +
  labs(title = "Average Match Length (Minutes) by Year",
       x = "Year", y = "Average Match Length (Minutes)")

plotly_plot <- ggplotly(p)

plotly_plot
```

### Wins by Seed
```{r seed, echo = FALSE, message = FALSE, warning = FALSE}
seed_performance <- tennis_data %>%
  group_by(winner_seed) %>%
  summarize(total_wins = n(), .groups = 'drop') %>%
  filter(!is.na(winner_seed))

ggplot(seed_performance, aes(x = as.factor(winner_seed), y = total_wins)) +
  geom_tile(aes(fill = total_wins)) +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  labs(title = "Win Counts by Seeds",
       x = "Seed", y = "Total Wins") +
  theme_minimal()
```
